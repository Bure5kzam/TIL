파이썬 객체의 구조

C와 C++, C#을 쓰던 나에게 파이썬의 클래스 개념은 오묘하기 그지없다.

변수에 클래스를 넣어버린다거나, 메서드 내에서 self로 없던 필드를 정의해버리는 다이나믹한 행태를 보면 거의 기행처럼 느껴진다. 이것이 인터프리터 언어의 세계인가 싶기도 하고..

회사에서 ros 개발 하느라 사용한지 어느덧 반년, 얼추 프로토 기능이 완성되니 유지관리와 리팩토링의 필요성을 느낀다. 디자인 패턴을 적용하지 않으면 코드 수정과 유지관리 만으로도 내 업무시간을 다 쓰게 되겠다는 예감이 든다.

원했던 개발자는 아니지만 하게 된 이상 잘해내고 싶기에.. 이것 저것 찾아 공부를 해본다


# 클래스

파이썬에서 클래스가 뭔지 생각해보았다.

어느 언어든 클래스는 인스턴스를 만들기 위한 데이터 구조다.

기억을 더듬어보면 컴파일 언어에서는 클래스가 작성된 소스코드를 빌드해서 저급 언어로 바꾸며, 이를 로드해서 cpu에 집어넣는다. 그래서 변경내용을 반영하려면 실행중이던 프로그램을 끄고 새로 빌드해서 실행해야 한다.

반면 파이썬은 인터프리터 언어다.
그래서일까 미리 정의한 클래스에 없던 멤버를 새로 추가하는 기행이 가능하다.

``` python

bure@burepool:~$ python3
Python 3.10.12 (main, Nov 20 2023, 15:14:05) [GCC 11.4.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> class A():
...     def __init__(self):
...             self.msg = "hi"
... 
>>> print(A)
<class '__main__.A'>
>>> A.new_msg = "hello"
>>> print(A.new_msg)
hello

# A에 없던 new_msg 라는 필드가 추가되었다.
```

이게 가능한 이유는 파이썬에서는 클래스 조차도 런타임 중에 할당받는 인스턴스이기 때문이다.

이는 컴파일 언어 인터프리터에서 클래스가 산정할 메모리 크기를 계산하기 위해 사용되는 것과 다르다.

파이썬에서 클래스를 정의할 때는 내부적으로

`type`(메타클레스)로 `type instance`(클래스)를 생성하고, 그걸로 클래스의 인스턴스를 생성한다. 몰래 type으로 생성하는 단계가 하나 더 있는데 컴파일 언어과 유사한 문법 뒤에 감춰진 것이다.

```python
# A라는 클래스를 생성한다.

class A():
	cls_var = "hello"
	def __init__(self):
	self.ist_var = "hi"

print(A)
a = A()
print(a)
  

# B라는 클래스를 생성한다.
B = type("B",(),{"msg":"hi"})
print(B)
b = B()
print(b)
```


그렇다보니 컴파일 언어에서는 보지도 못한 별별 이상한 짓들을 할 수 있다.
클래스의 생성자를 호출하는 녀석을 재정의한다던가. (컴파일에서 생성자를 호출하는건 **인터프리터**다.)
